<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Guestbook Slideshow</title>
<style>
  :root{ --bg:#000; --ink:#fff; --muted:#cbd5e1; }
  *{box-sizing:border-box;}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Roboto,Arial; overflow:hidden;}
  .frame{position:fixed; inset:0; display:flex; align-items:center; justify-content:center;}
  .img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:contrast(1.05) saturate(1.05);}
  .shade{position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.55) 0%, rgba(0,0,0,.10) 55%, rgba(0,0,0,.55) 100%);}
  .card{
    position:absolute; left:3.5vw; right:3.5vw; bottom:3.5vw;
    padding:22px 22px; border-radius:22px;
    background:rgba(0,0,0,.35); backdrop-filter: blur(10px);
    border:1px solid rgba(255,255,255,.12);
    max-width:1100px; margin:0 auto;
  }
  .name{font-size:clamp(22px,3.2vw,44px); font-weight:900; margin:0;}
  .meta{color:var(--muted); margin-top:6px; font-size:clamp(12px,1.5vw,18px);}
  .msg{margin-top:12px; font-size:clamp(16px,2.2vw,28px); line-height:1.25; white-space:pre-wrap;}
  .tiny{position:absolute; top:14px; right:14px; color:rgba(255,255,255,.65); font-size:12px;}
</style>
</head>
<body>
<div class="frame">
  <img class="img" id="img" alt="slide"/>
  <div class="shade"></div>
  <div class="card">
    <div class="tiny" id="tiny"></div>
    <p class="name" id="name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    <div class="meta" id="meta"></div>
    <div class="msg" id="msg"></div>
  </div>
</div>

<script>
/** ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ */
const CONFIG = {
  WEBAPP_URL: "https://script.google.com/macros/s/AKfycbz9Qnruk5_qucZwhrNXgD00K7uL5qOwYfUMjnahY5HTZz0lp3TALMXhMILItEc8un5IVw/exec",
  ADMIN_TOKEN: "NY2026_SIM_Admin_9XkL2Q",
  INTERVAL_MS: 7000
};

const elImg = document.getElementById("img");
const elName = document.getElementById("name");
const elMeta = document.getElementById("meta");
const elMsg = document.getElementById("msg");
const elTiny = document.getElementById("tiny");

let rows = [];
let idx = 0;

function setSlide(r){
  elName.textContent = r.name || "-";
  elMeta.textContent = [r.team, r.time].filter(Boolean).join(" ‚Ä¢ ");
  elMsg.textContent = r.message || "";
  elImg.src = r.photoUrl || "data:image/svg+xml;charset=utf-8," + encodeURIComponent(
    `<svg xmlns='http://www.w3.org/2000/svg' width='1920' height='1080'>
      <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
        <stop offset='0' stop-color='#1f2937'/><stop offset='1' stop-color='#0b0f19'/>
      </linearGradient></defs>
      <rect width='100%' height='100%' fill='url(#g)'/>
      <text x='50%' y='50%' fill='#cbd5e1' font-size='64' text-anchor='middle' dominant-baseline='middle'>Guestbook</text>
    </svg>`
  );
  elTiny.textContent = `(${idx+1}/${rows.length})`;
}

async function loadRows(){
  if(!CONFIG.WEBAPP_URL.includes("http")) throw new Error("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà WEBAPP_URL");
  if(!CONFIG.ADMIN_TOKEN || CONFIG.ADMIN_TOKEN.includes("PUT_")) throw new Error("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà ADMIN_TOKEN");
  const url = CONFIG.WEBAPP_URL + "?action=list&token=" + encodeURIComponent(CONFIG.ADMIN_TOKEN);
  const res = await fetch(url);
  const data = await res.json();
  if(!res.ok || !data.ok) throw new Error(data.error || "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  rows = (data.rows || []).filter(Boolean);
  // ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô
  rows.reverse();
  idx = 0;
}

async function start(){
  try{
    await loadRows();
    if(rows.length===0){
      elName.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ù‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°";
      elMeta.textContent = "";
      elMsg.textContent = "‡∏£‡∏≠‡∏Ñ‡∏ô‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üéâ";
      return;
    }
    setSlide(rows[idx]);
    setInterval(async ()=>{
      idx = (idx + 1) % rows.length;
      setSlide(rows[idx]);
      // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å 1 ‡∏£‡∏≠‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
      if(idx === 0){
        try{ await loadRows(); } catch(e){ /* ignore */ }
      }
    }, CONFIG.INTERVAL_MS);
  }catch(e){
    elName.textContent = "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö/‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    elMeta.textContent = "";
    elMsg.textContent = String(e.message || e);
  }
}
start();
</script>
</body>
</html>
